inspired by https://github.com/michelp/pgfsm

According to [this post](https://stackoverflow.com/questions/1003034/sql-case-vs-join-efficiency), we should prefer `JOIN` over `CASE`.
